
<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<style type="text/css">

html,
body {
    margin: 0;
    height: 100%;
}
/* Scale canvas with resize attribute to full size */
canvas[resize] {
    display: block;
    width: 100%;
    height: 100%;
    background-color : white;
}


div.container{
  width: 100%;
  //border: 1px solid gray;
}

header, footer{
  width: 100%;
  padding: 1em;
  color: white;
  background-color: purple;
  clear: left;
  text-align: center;
}

nav{
  float: left;
  max-width: 160px;
  margin: 0;
  padding: 1em;
}

nav ul{
  list-style-type: none;
  padding: 0;
}

nav ul a{
  text-decoration: none;
}

article {
  margin-left: 170px;
  border-left: 1px solid gray;
  padding: 1em;
  overflow: hidden;
}

/*#article {
  margin-left: 170px;
  border-left: 1px solid gray;
  padding: 10em;
  overflow: hidden;
}*/


</style>
<script type = "text/javascript" src = "http://paperjs.org/assets/js/paper.js"> </script>
</head>

<body>
<!-- hello, world! -->
<canvas id="canvas-1" hidpi="on" resize = "true" ></canvas>
</body>

<script type= "text/paperscript" canvas = "canvas-1" >
var MyCharacterClass = function(){
  this.airPollution = 0;
  this.airPollution2 = 0;

  this.grade = new PointText({
    point:[460,360],
    content:"",
    fontSize: 50
  });
  this.index = new PointText({
    point:[460,260],
    content:"",
    fontSize: 150
  });
  this.text = new PointText({
    point:[460,100],
    content:"",
    fontSize: 80
  });

  this.albumen = new Path({
         segments: [[30,40], [150,0], [220,0], [300,70], [320,120], [300,180], [280,240], [200,300], [60,290], [30,250], [-20,180], [0,130]],
         closed: true
     });

  this.albumen.style = {
       fillColor: '#fcfcfc',
       strokeColor: '#efefef',
       strokeWidth: 5
     };

  this.albumen.smooth({
       type: 'catmull-rom',
       factor: 0.4
     });

     this.vitellus = new Shape.Circle([150,150], 76);
     this.vitellus.style = {
       fillColor: '#ffd500',
       strokeWidth: 5
     };


     /* 눈 */
     this.sclera = new Shape.Ellipse({
       center: [0, 0],
       radius: [30, 38],
       fillColor: 'white',
       strokeColor: '#efe3e8',
       strokeWidth: 4
     });

     this.iris = new Shape.Circle({
       center: [10, 0],
       radius: 15,
       fillColor: '#661fb4',
       strokeColor: '#220a3c',
       strokeWidth: 4
     });

     this.pupil = new Shape.Circle({
       center: [10, 0],
       radius: 9,
       fillColor: '#220a3c',
     });

     this.highlight = new Shape.Circle({
       center: [15, -8],
       radius: 3,
       fillColor: 'white'
     });

     this.eye = new Group([this.sclera, this.iris, this.pupil, this.highlight]);
     this.eye.position = [143,150];

     this.eye_l = this.eye.clone();
     this.eye.position.x += 50;



     /* 팔 */
     this.arm_origin = new Point(15, 0);
     this.arm_joint = new Point(25, 70);
     this.arm_end = new Point(0, 140);

     this.arm_path = new Path({
         segments: [this.arm_origin, this.arm_joint, this.arm_end],
         closed: false,
         strokeColor: '#222',
         strokeWidth: 20,
     });

     this.arm_path.smooth({
       type: 'continuous'
     });
     this.arm_path.strokeCap = 'round';

     this.arm = new Group([this.arm_path]);
     this.arm.position.y =+ 250;
     this.arm_l = this.arm.clone();
     this.arm_l.position.x -= 20;
     this.arm_l.children[0].pivot = this.arm_l.children[0].segments[0].point;
     this.arm_l.rotate(20);
     this.arm_r = this.arm.clone();
     this.arm_r.position.x += 310;
     this.arm_r.children[0].pivot = this.arm_r.children[0].segments[0].point;
     this.arm_r.position.y -= 80;
     this.arm_r.rotate(50);

     this.arm_r.rotate(-70);
     this.arm_r.position.x -= 15;
     this.arm_r.position.y += 70;
     this.arm_l.rotate(180);
     this.arm_l.position.y -= 5;

     this.arm.visible = false;

     this.arm_l.applyMatrix = false;
     this.arm_r.applyMatrix = false;
     this.eyebrow_l = new Path({
       segments:[[185, 113], [230, 133]],
       closed: false,
       strokeColor: 'black',
       strokeWidth: 10
     });
     this.eyebrow_r = new Path({
       segments:[[115, 133], [160, 113]],
       closed: false,
       strokeColor: 'black',
       strokeWidth: 10
     });

     this.eyebrow = new Group([this.eyebrow_r, this.eyebrow_l]);
     this.eyebrow_r.visible = false;
     this.eyebrow_l.visible = false;

     this.smile = new Path({
       segments : [[130, 180],[175, 200], [220, 180]],
       closed : false,
       strokeColor: 'black',
       strokeWidth: 10
     });

     this.smile.smooth({
         type: 'continuous'
       });
    this.smile.visible = false;
     /* 다리 */
     this.leg_origin = new Point(0, 0);
     this.leg_joint = new Point(10, 40);
     this.leg_end = new Point(0, 80);

     this.socksColor = new Gradient({
         stops: [['#222', 0.15], ['white', 0.15], ['white', 0.25], ['#661fb4', 0.25],
         ['#661fb4', 0.35], ['white', 0.35], ['white', 0.4], ['#661fb4', 0.4], ['#661fb4', 0.5],['white', 0.5]],
         origin: this.leg_joint,
         destination: this.leg_end
     });
     this.socks = new Color(this.socksColor, this.leg_joint, this.leg_end);

     this.leg_path = new Path(this.leg_origin, this.leg_joint, this.leg_end);
     this.leg_path.strokeColor = this.socks;
     this.leg_path.strokeWidth = 25;
     this.leg_path.smooth({
       type: 'continuous'
     });

     this.shoes = new Path({
       segments : [[0,5], [30,5], [25,17], [50,17], [55,35], [0,35]],
       closed: true,

       fillColor: '#692c21',
       strokeColor: '#56241b',
       strokeWidth: 3
     });

     this.shoes.smooth({
         type: 'continuous',
         from: 2,
         to: 4
     });
     this.shoes.rotate(20);
     this.shoes.position.x -= 15;
     this.shoes.position.y += 70;
     this.leg = new Group([this.leg_path, this.shoes]);
     this.leg.position.x =+ 150;
     this.leg.position.y =+ 350;

     this.leg_l = this.leg.clone();
     this.leg_l.position.x -= 40;
     this.leg_l.position.y -= 5;

     this.leg_r = this.leg.clone();
     this.leg_r.position.x += 60;
     this.leg_r.rotate(-20);

     this.leg.visible = false;



     this.egg_body = new Group ([this.albumen, this.vitellus]);
    //this.eye = new Group([this.sclera, this.iris, this.pupil, this.highlight]);
     this.eyes = new Group([this.eye, this.eye_l, this.eyebrow_r, this.eyebrow_l, this.smile]);
     //this.arm = new Group([this.arm_path]);
     this.arms = new Group([this.arm_l, this.arm_r]);
     //this.leg_path = new Path(this.leg_origin, this.leg_joint, this.leg_end);
     //this.leg = new Group([this.leg_path, this.shoes]);
     this.legs = new Group([this.leg_l, this.leg_r]);
     this.character = new Group([this.legs, this.arms, this.egg_body, this.eyes, this.text, this.index, this.grade]);

     this.character.applyMatrix = false;
     this.character.scale(0.7);

     this.character.applyMatrix = false;
     this.sad = function(){

       //arms
       this.arm_l.strokeColor = '#ffd500';
       this.arm_r.strokeColor = '#ffd500';


       //legs
       this.leg_l.strokeColor = 'black';
       this.leg_r.strokeColor = 'black';

       //shoes
       this.shoes.style = {
         strokeColor : "black",
         fillColor : "black"
       };

       //face
       this.albumen.style = {
         strokeColor : "black",
         fillColor : "black"
       };

       //eyes
       this.pupil.style = {
         strokeColor : "black",
         strokeWidth : 3,
         fillColor : "black"
       };

       this.pupil.style = {
         strokeColor : "black",
         strokeWidth : 3,
         fillColor : "black"
       };
       this.index.fillColor = 'red';
       this.text.fillColor = 'red';
       this.grade.fillColor = 'red';

     this.eyebrow_r.visible = true;
     this.eyebrow_l.visible = true;
     }
     this.arm.applyMatrix = false;
     this.happy = function() {
       this.index.fillColor = 'blue';
       this.text.fillColor = 'blue';
       this.grade.fillColor = 'blue';

       this.albumen.fillColor = 'blue';
       this.albumen.strokeColor='blue';

       this.smile.visible = true;

       this.arm_l.strokeColor = '#222';
       this.arm_r.strokeColor = '#222';
    }

    this.normal = function(){
      this.grade.fillColor = 'black';
      this.index.fillColor = 'black';
      this.text.fillColor = 'black';
      this.smile.visible = false;
      this.eyebrow.visible = false;


      this.albumen.style = {
           fillColor: '#fcfcfc',
           strokeColor: '#efefef',
           strokeWidth: 5
         };

      this.albumen.smooth({
           type: 'catmull-rom',
           factor: 0.4
         });

       this.vitellus.style = {
         fillColor: '#ffd500',
         strokeWidth: 5
       };

    }
    this.changeText = function(forContent){
      this.text.content = forContent;
    }
    this.changeIndex = function(forContent){
      this.index.content = forContent;
    }

    this.changeGrade = function(forContent){
      this.grade.content = forContent;
    }

}

  var mouse = new MyCharacterClass();
  mouse.arms.visible = false;
  mouse.legs.visible = false;
  mouse.character.scale(0.2);

  console.log(mouse.character);

  function onMouseMove(event) {
    mouse.character.position = event.point;
  }

var family = new Array(25);

for(var i =0; i < 5; i++){
  for(var j =0; j < 5; j++){
  family[i + j*5] = new MyCharacterClass();
  family[i + j*5].character.position = [
    i * view.bounds.width/5 + view.bounds.width/15,
    j * view.bounds.height/5 + view.bounds.height/10
  ];
  family[i + j * 5].character.scale(0.4);
  }
}

var countNum;

function onFrame(event) {
  if(event.count % 250 == 0) {
    countNum = countNum + 1;
    loadXML('http://openapi.seoul.go.kr:8088/67695847446d6573353664736e6d50/xml/ListAirQualityByDistrictService/1/25/');
  }
}


function loadXML(url)
{
  var request = new XMLHttpRequest();
  request.open("GET", url, true);
  request.onload = function()
  {
    if(request.readyState == 4)
    {
      if(request.status == 200)
      {
        var temp = request.responseXML;
        for( var i = 0; i < 5 ; i++ )
        {
          for( var j = 0; j < 5 ; j++ )
          {
            family[i*5 + j].airPollution = temp.getElementsByTagName("MAXINDEX")[i*5+j].childNodes[0].nodeValue;
            //console.log(family[i*5 + j].airPollution);
            family[i*5 + j].airPollution2 = temp.getElementsByTagName("PM10")[i*5+j].childNodes[0].nodeValue;
            console.log(family[i*5 + j].airPollution);

            if(family[i*5 + j].airPollution > 70)
            {
              family[i*5 + j].sad();
            }else if(family[i*5 + j].airPollution < 50){
              family[i*5 + j].happy();
            }else{
              family[i*5 + j].normal();
            }

            family[i*5 + j].changeText(temp.getElementsByTagName("MSRSTENAME")[i*5+j].childNodes[0].nodeValue);
            family[i*5 + j].changeIndex(temp.getElementsByTagName("MAXINDEX")[i*5+j].childNodes[0].nodeValue);
            family[i*5 + j].changeGrade(temp.getElementsByTagName("GRADE")[i*5+j].childNodes[0].nodeValue);
          }
        }

      }
    }
  }
  request.send();
}

var changingVolume;

var webaudio_tooling_obj = function () {

      var audioContext = new AudioContext();
      console.log("audio is starting up ...");
      var BUFF_SIZE = 16384;
      var audioInput = null,
          microphone_stream = null,
          gain_node = null,
          script_processor_node = null,
          script_processor_fft_node = null,
          analyserNode = null;

      if (!navigator.getUserMedia)
              navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia ||
                            navigator.mozGetUserMedia || navigator.msGetUserMedia;

      if (navigator.getUserMedia){

          navigator.getUserMedia({audio:true},
            function(stream) {
                start_microphone(stream);

            },
            function(e) {
              alert('Error capturing audio.');
            }
          );

      } else { alert('getUserMedia not supported in this browser.'); }


}
</script>


</html>
